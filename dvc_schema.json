{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/who-dvc.schema.json",
  "title": "WHO Digital Vaccination Certificate (DVC) â€“ ModelDVC",
  "type": "object",
  "additionalProperties": false,

  "required": ["name", "dob", "vaccineDetails"],
  "properties": {
    "name": { "type": "string", "description": "Full name" },
    "dob":  { "type": "string", "format": "date", "description": "Date of birth" },
    "sex":  { "type": "string", "description": "Administrative gender" },
    "nationality": { "type": "string", "description": "Citizenship code" },
    "nid":  { "type": "string", "description": "National identifier" },
    "guardian": { "type": "string", "description": "Parent/Guardian name" },
    "issuer": { "$ref": "#/$defs/Reference", "description": "Issuing Organization reference" },

    "vaccineDetails": {
      "type": "array",
      "minItems": 1,
      "description": "Per-dose vaccination details",
      "items": { "$ref": "#/$defs/ModelVaccineDetails" }
    }
  },

  "$defs": {
    "uri": { "type": "string", "format": "uri" },

    "Coding": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "system": { "$ref": "#/$defs/uri" },
        "version": { "type": "string" },
        "code": { "type": "string" },
        "display": { "type": "string" },
        "userSelected": { "type": "boolean" }
      }
    },

    "CodeableConcept": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "coding": { "type": "array", "items": { "$ref": "#/$defs/Coding" } },
        "text": { "type": "string" }
      }
    },

    "Identifier": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "use": { "type": "string" },
        "type": { "$ref": "#/$defs/CodeableConcept" },
        "system": { "$ref": "#/$defs/uri" },
        "value": { "type": "string" },
        "assigner": { "$ref": "#/$defs/Reference" }
      }
    },

    "Reference": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "reference": { "type": "string" },
        "type": { "$ref": "#/$defs/uri" },
        "identifier": { "$ref": "#/$defs/Identifier" },
        "display": { "type": "string" }
      }
    },

    "Period": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "start": { "type": "string", "format": "date" },
        "end":   { "type": "string", "format": "date" }
      }
    },

    "NonEmptyCodeableConcept": {
      "allOf": [
        { "$ref": "#/$defs/CodeableConcept" },
        { "anyOf": [ { "required": ["text"] }, { "required": ["coding"] } ] },
        {
          "if": { "required": ["coding"] },
          "then": { "properties": { "coding": { "minItems": 1 } } }
        }
      ]
    },

    "ModelVaccineDetails": {
      "type": "object",
      "additionalProperties": false,
      "required": ["doseNumber", "disease", "vaccineClassification", "date", "manufacturer", "batchNo"],
      "properties": {
        "doseNumber": {
          "description": "Dose number",
          "$ref": "#/$defs/NonEmptyCodeableConcept"
        },
        "disease": {
          "description": "Targeted disease",
          "$ref": "#/$defs/Coding"
        },
        "vaccineClassification": {
          "description": "Vaccine/prophylaxis classification",
          "$ref": "#/$defs/NonEmptyCodeableConcept"
        },
        "vaccineTradeItem": {
          "description": "Trade item identifier",
          "$ref": "#/$defs/Identifier"
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "Vaccination date"
        },
        "clinicianName": {
          "type": "string",
          "description": "Clinician or authority name"
        },
        "issuer": {
          "$ref": "#/$defs/Reference",
          "description": "Per-dose issuing Organization reference"
        },
        "manufacturerId": {
          "description": "Manufacturer identifier",
          "$ref": "#/$defs/Identifier"
        },
        "manufacturer": {
          "type": "string",
          "description": "Manufacturer name"
        },
        "batchNo": {
          "type": "string",
          "description": "Batch or lot number"
        },
        "validityPeriod": {
          "description": "Certificate validity period",
          "$ref": "#/$defs/Period"
        }
      }
    }
  }
}
